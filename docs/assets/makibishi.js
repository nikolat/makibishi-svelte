var Vn=Object.defineProperty;var Wn=(e,t,n)=>t in e?Vn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var v=(e,t,n)=>Wn(e,typeof t!="symbol"?t+"":t,n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();function Re(){}function an(e){return e()}function Pt(){return Object.create(null)}function De(e){e.forEach(an)}function fn(e){return typeof e=="function"}function Zn(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}let ze;function ke(e,t){return e===t?!0:(ze||(ze=document.createElement("a")),ze.href=t,e===ze.href)}function Dn(e){return Object.keys(e).length===0}function Me(e,t){e.appendChild(t)}function Q(e,t,n){e.insertBefore(t,n||null)}function G(e){e.parentNode&&e.parentNode.removeChild(e)}function Gn(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function ee(e){return document.createElement(e)}function At(e){return document.createTextNode(e)}function Bt(){return At(" ")}function Fn(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function k(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function Yn(e){return Array.from(e.childNodes)}function ln(e,t){t=""+t,e.data!==t&&(e.data=t)}let Ce;function He(e){Ce=e}function Jn(){if(!Ce)throw new Error("Function called outside component initialization");return Ce}function Qn(e){Jn().$$.on_mount.push(e)}const Se=[],qt=[];let $e=[];const zt=[],Xn=Promise.resolve();let ht=!1;function er(){ht||(ht=!0,Xn.then(un))}function dt(e){$e.push(e)}const nt=new Set;let Ae=0;function un(){if(Ae!==0)return;const e=Ce;do{try{for(;Ae<Se.length;){const t=Se[Ae];Ae++,He(t),tr(t.$$)}}catch(t){throw Se.length=0,Ae=0,t}for(He(null),Se.length=0,Ae=0;qt.length;)qt.pop()();for(let t=0;t<$e.length;t+=1){const n=$e[t];nt.has(n)||(nt.add(n),n())}$e.length=0}while(Se.length);for(;zt.length;)zt.pop()();ht=!1,nt.clear(),He(e)}function tr(e){if(e.fragment!==null){e.update(),De(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(dt)}}function nr(e){const t=[],n=[];$e.forEach(r=>e.indexOf(r)===-1?t.push(r):n.push(r)),n.forEach(r=>r()),$e=t}const rr=new Set;function or(e,t){e&&e.i&&(rr.delete(e),e.i(t))}function Mt(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}function sr(e,t,n){const{fragment:r,after_update:o}=e.$$;r&&r.m(t,n),dt(()=>{const s=e.$$.on_mount.map(an).filter(fn);e.$$.on_destroy?e.$$.on_destroy.push(...s):De(s),e.$$.on_mount=[]}),o.forEach(dt)}function ir(e,t){const n=e.$$;n.fragment!==null&&(nr(n.after_update),De(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function cr(e,t){e.$$.dirty[0]===-1&&(Se.push(e),er(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function ar(e,t,n,r,o,s,i=null,c=[-1]){const a=Ce;He(e);const f=e.$$={fragment:null,ctx:[],props:s,update:Re,not_equal:o,bound:Pt(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(a?a.$$.context:[])),callbacks:Pt(),dirty:c,skip_bound:!1,root:t.target||a.$$.root};i&&i(f.root);let u=!1;if(f.ctx=n?n(e,t.props||{},(l,g,...d)=>{const w=d.length?d[0]:g;return f.ctx&&o(f.ctx[l],f.ctx[l]=w)&&(!f.skip_bound&&f.bound[l]&&f.bound[l](w),u&&cr(e,l)),g}):[],f.update(),u=!0,De(f.before_update),f.fragment=r?r(f.ctx):!1,t.target){if(t.hydrate){const l=Yn(t.target);f.fragment&&f.fragment.l(l),l.forEach(G)}else f.fragment&&f.fragment.c();t.intro&&or(e.$$.fragment),sr(e,t.target,t.anchor),un()}He(a)}class fr{constructor(){v(this,"$$");v(this,"$$set")}$destroy(){ir(this,1),this.$destroy=Re}$on(t,n){if(!fn(n))return Re;const r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(n),()=>{const o=r.indexOf(n);o!==-1&&r.splice(o,1)}}$set(t){this.$$set&&!Dn(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const lr="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(lr);function jt(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function hn(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function ur(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");jt(e.outputLen),jt(e.blockLen)}function je(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function hr(e,t){hn(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const rt=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const dn=e=>e instanceof Uint8Array,ot=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),F=(e,t)=>e<<32-t|e>>>t,dr=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!dr)throw new Error("Non little-endian hardware is not supported");function gr(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function St(e){if(typeof e=="string"&&(e=gr(e)),!dn(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}function wr(...e){const t=new Uint8Array(e.reduce((r,o)=>r+o.length,0));let n=0;return e.forEach(r=>{if(!dn(r))throw new Error("Uint8Array expected");t.set(r,n),n+=r.length}),t}let gn=class{clone(){return this._cloneInto()}};function pr(e){const t=r=>e().update(St(r)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function wn(e=32){if(rt&&typeof rt.getRandomValues=="function")return rt.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}function yr(e,t,n,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,r);const o=BigInt(32),s=BigInt(4294967295),i=Number(n>>o&s),c=Number(n&s),a=r?4:0,f=r?0:4;e.setUint32(t+a,i,r),e.setUint32(t+f,c,r)}let br=class extends gn{constructor(t,n,r,o){super(),this.blockLen=t,this.outputLen=n,this.padOffset=r,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=ot(this.buffer)}update(t){je(this);const{view:n,buffer:r,blockLen:o}=this;t=St(t);const s=t.length;for(let i=0;i<s;){const c=Math.min(o-this.pos,s-i);if(c===o){const a=ot(t);for(;o<=s-i;i+=o)this.process(a,i);continue}r.set(t.subarray(i,i+c),this.pos),this.pos+=c,i+=c,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){je(this),hr(t,this),this.finished=!0;const{buffer:n,view:r,blockLen:o,isLE:s}=this;let{pos:i}=this;n[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>o-i&&(this.process(r,0),i=0);for(let l=i;l<o;l++)n[l]=0;yr(r,o-8,BigInt(this.length*8),s),this.process(r,0);const c=ot(t),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const f=a/4,u=this.get();if(f>u.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<f;l++)c.setUint32(4*l,u[l],s)}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const r=t.slice(0,n);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:n,buffer:r,length:o,finished:s,destroyed:i,pos:c}=this;return t.length=o,t.pos=c,t.finished=s,t.destroyed=i,o%n&&t.buffer.set(r),t}};const mr=(e,t,n)=>e&t^~e&n,Er=(e,t,n)=>e&t^e&n^t&n,xr=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ae=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),fe=new Uint32Array(64);let vr=class extends br{constructor(){super(64,32,8,!1),this.A=ae[0]|0,this.B=ae[1]|0,this.C=ae[2]|0,this.D=ae[3]|0,this.E=ae[4]|0,this.F=ae[5]|0,this.G=ae[6]|0,this.H=ae[7]|0}get(){const{A:t,B:n,C:r,D:o,E:s,F:i,G:c,H:a}=this;return[t,n,r,o,s,i,c,a]}set(t,n,r,o,s,i,c,a){this.A=t|0,this.B=n|0,this.C=r|0,this.D=o|0,this.E=s|0,this.F=i|0,this.G=c|0,this.H=a|0}process(t,n){for(let l=0;l<16;l++,n+=4)fe[l]=t.getUint32(n,!1);for(let l=16;l<64;l++){const g=fe[l-15],d=fe[l-2],w=F(g,7)^F(g,18)^g>>>3,h=F(d,17)^F(d,19)^d>>>10;fe[l]=h+fe[l-7]+w+fe[l-16]|0}let{A:r,B:o,C:s,D:i,E:c,F:a,G:f,H:u}=this;for(let l=0;l<64;l++){const g=F(c,6)^F(c,11)^F(c,25),d=u+g+mr(c,a,f)+xr[l]+fe[l]|0,h=(F(r,2)^F(r,13)^F(r,22))+Er(r,o,s)|0;u=f,f=a,a=c,c=i+d|0,i=s,s=o,o=r,r=d+h|0}r=r+this.A|0,o=o+this.B|0,s=s+this.C|0,i=i+this.D|0,c=c+this.E|0,a=a+this.F|0,f=f+this.G|0,u=u+this.H|0,this.set(r,o,s,i,c,a,f,u)}roundClean(){fe.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const gt=pr(()=>new vr);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const pn=BigInt(0),Ge=BigInt(1),_r=BigInt(2),Fe=e=>e instanceof Uint8Array,Ar=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function Ie(e){if(!Fe(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=Ar[e[n]];return t}function yn(e){const t=e.toString(16);return t.length&1?`0${t}`:t}function $t(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return BigInt(e===""?"0":`0x${e}`)}function Le(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);const t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(t/2);for(let r=0;r<n.length;r++){const o=r*2,s=e.slice(o,o+2),i=Number.parseInt(s,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");n[r]=i}return n}function q(e){return $t(Ie(e))}function kt(e){if(!Fe(e))throw new Error("Uint8Array expected");return $t(Ie(Uint8Array.from(e).reverse()))}function de(e,t){return Le(e.toString(16).padStart(t*2,"0"))}function It(e,t){return de(e,t).reverse()}function Br(e){return Le(yn(e))}function P(e,t,n){let r;if(typeof t=="string")try{r=Le(t)}catch(s){throw new Error(`${e} must be valid hex string, got "${t}". Cause: ${s}`)}else if(Fe(t))r=Uint8Array.from(t);else throw new Error(`${e} must be hex string or Uint8Array`);const o=r.length;if(typeof n=="number"&&o!==n)throw new Error(`${e} expected ${n} bytes, got ${o}`);return r}function me(...e){const t=new Uint8Array(e.reduce((r,o)=>r+o.length,0));let n=0;return e.forEach(r=>{if(!Fe(r))throw new Error("Uint8Array expected");t.set(r,n),n+=r.length}),t}function Sr(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function $r(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function kr(e){let t;for(t=0;e>pn;e>>=Ge,t+=1);return t}function Ir(e,t){return e>>BigInt(t)&Ge}const Lr=(e,t,n)=>e|(n?Ge:pn)<<BigInt(t),Lt=e=>(_r<<BigInt(e-1))-Ge,st=e=>new Uint8Array(e),Kt=e=>Uint8Array.from(e);function bn(e,t,n){if(typeof e!="number"||e<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let r=st(e),o=st(e),s=0;const i=()=>{r.fill(1),o.fill(0),s=0},c=(...l)=>n(o,r,...l),a=(l=st())=>{o=c(Kt([0]),l),r=c(),l.length!==0&&(o=c(Kt([1]),l),r=c())},f=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let l=0;const g=[];for(;l<t;){r=c();const d=r.slice();g.push(d),l+=r.length}return me(...g)};return(l,g)=>{i(),a(l);let d;for(;!(d=g(f()));)a();return i(),d}}const Or={bigint:e=>typeof e=="bigint",function:e=>typeof e=="function",boolean:e=>typeof e=="boolean",string:e=>typeof e=="string",stringOrUint8Array:e=>typeof e=="string"||e instanceof Uint8Array,isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>typeof e=="function"&&Number.isSafeInteger(e.outputLen)};function qe(e,t,n={}){const r=(o,s,i)=>{const c=Or[s];if(typeof c!="function")throw new Error(`Invalid validator "${s}", expected function`);const a=e[o];if(!(i&&a===void 0)&&!c(a,e))throw new Error(`Invalid param ${String(o)}=${a} (${typeof a}), expected ${s}`)};for(const[o,s]of Object.entries(t))r(o,s,!1);for(const[o,s]of Object.entries(n))r(o,s,!0);return e}const Tr=Object.freeze(Object.defineProperty({__proto__:null,bitGet:Ir,bitLen:kr,bitMask:Lt,bitSet:Lr,bytesToHex:Ie,bytesToNumberBE:q,bytesToNumberLE:kt,concatBytes:me,createHmacDrbg:bn,ensureBytes:P,equalBytes:Sr,hexToBytes:Le,hexToNumber:$t,numberToBytesBE:de,numberToBytesLE:It,numberToHexUnpadded:yn,numberToVarBytesBE:Br,utf8ToBytes:$r,validateObject:qe},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const R=BigInt(0),N=BigInt(1),ye=BigInt(2),Ur=BigInt(3),wt=BigInt(4),Vt=BigInt(5),Wt=BigInt(8);BigInt(9);BigInt(16);function C(e,t){const n=e%t;return n>=R?n:t+n}function Nr(e,t,n){if(n<=R||t<R)throw new Error("Expected power/modulo > 0");if(n===N)return R;let r=N;for(;t>R;)t&N&&(r=r*e%n),e=e*e%n,t>>=N;return r}function W(e,t,n){let r=e;for(;t-- >R;)r*=r,r%=n;return r}function pt(e,t){if(e===R||t<=R)throw new Error(`invert: expected positive integers, got n=${e} mod=${t}`);let n=C(e,t),r=t,o=R,s=N;for(;n!==R;){const c=r/n,a=r%n,f=o-s*c;r=n,n=a,o=s,s=f}if(r!==N)throw new Error("invert: does not exist");return C(o,t)}function Hr(e){const t=(e-N)/ye;let n,r,o;for(n=e-N,r=0;n%ye===R;n/=ye,r++);for(o=ye;o<e&&Nr(o,t,e)!==e-N;o++);if(r===1){const i=(e+N)/wt;return function(a,f){const u=a.pow(f,i);if(!a.eql(a.sqr(u),f))throw new Error("Cannot find square root");return u}}const s=(n+N)/ye;return function(c,a){if(c.pow(a,t)===c.neg(c.ONE))throw new Error("Cannot find square root");let f=r,u=c.pow(c.mul(c.ONE,o),n),l=c.pow(a,s),g=c.pow(a,n);for(;!c.eql(g,c.ONE);){if(c.eql(g,c.ZERO))return c.ZERO;let d=1;for(let h=c.sqr(g);d<f&&!c.eql(h,c.ONE);d++)h=c.sqr(h);const w=c.pow(u,N<<BigInt(f-d-1));u=c.sqr(w),l=c.mul(l,w),g=c.mul(g,u),f=d}return l}}function Rr(e){if(e%wt===Ur){const t=(e+N)/wt;return function(r,o){const s=r.pow(o,t);if(!r.eql(r.sqr(s),o))throw new Error("Cannot find square root");return s}}if(e%Wt===Vt){const t=(e-Vt)/Wt;return function(r,o){const s=r.mul(o,ye),i=r.pow(s,t),c=r.mul(o,i),a=r.mul(r.mul(c,ye),i),f=r.mul(c,r.sub(a,r.ONE));if(!r.eql(r.sqr(f),o))throw new Error("Cannot find square root");return f}}return Hr(e)}const Cr=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Pr(e){const t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=Cr.reduce((r,o)=>(r[o]="function",r),t);return qe(e,n)}function qr(e,t,n){if(n<R)throw new Error("Expected power > 0");if(n===R)return e.ONE;if(n===N)return t;let r=e.ONE,o=t;for(;n>R;)n&N&&(r=e.mul(r,o)),o=e.sqr(o),n>>=N;return r}function zr(e,t){const n=new Array(t.length),r=t.reduce((s,i,c)=>e.is0(i)?s:(n[c]=s,e.mul(s,i)),e.ONE),o=e.inv(r);return t.reduceRight((s,i,c)=>e.is0(i)?s:(n[c]=e.mul(s,n[c]),e.mul(s,i)),o),n}function mn(e,t){const n=t!==void 0?t:e.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function Mr(e,t,n=!1,r={}){if(e<=R)throw new Error(`Expected Field ORDER > 0, got ${e}`);const{nBitLength:o,nByteLength:s}=mn(e,t);if(s>2048)throw new Error("Field lengths over 2048 bytes are not supported");const i=Rr(e),c=Object.freeze({ORDER:e,BITS:o,BYTES:s,MASK:Lt(o),ZERO:R,ONE:N,create:a=>C(a,e),isValid:a=>{if(typeof a!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof a}`);return R<=a&&a<e},is0:a=>a===R,isOdd:a=>(a&N)===N,neg:a=>C(-a,e),eql:(a,f)=>a===f,sqr:a=>C(a*a,e),add:(a,f)=>C(a+f,e),sub:(a,f)=>C(a-f,e),mul:(a,f)=>C(a*f,e),pow:(a,f)=>qr(c,a,f),div:(a,f)=>C(a*pt(f,e),e),sqrN:a=>a*a,addN:(a,f)=>a+f,subN:(a,f)=>a-f,mulN:(a,f)=>a*f,inv:a=>pt(a,e),sqrt:r.sqrt||(a=>i(c,a)),invertBatch:a=>zr(c,a),cmov:(a,f,u)=>u?f:a,toBytes:a=>n?It(a,s):de(a,s),fromBytes:a=>{if(a.length!==s)throw new Error(`Fp.fromBytes: expected ${s}, got ${a.length}`);return n?kt(a):q(a)}});return Object.freeze(c)}function En(e){if(typeof e!="bigint")throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function xn(e){const t=En(e);return t+Math.ceil(t/2)}function jr(e,t,n=!1){const r=e.length,o=En(t),s=xn(t);if(r<16||r<s||r>1024)throw new Error(`expected ${s}-1024 bytes of input, got ${r}`);const i=n?q(e):kt(e),c=C(i,t-N)+N;return n?It(c,o):de(c,o)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Kr=BigInt(0),it=BigInt(1);function Vr(e,t){const n=(o,s)=>{const i=s.negate();return o?i:s},r=o=>{const s=Math.ceil(t/o)+1,i=2**(o-1);return{windows:s,windowSize:i}};return{constTimeNegate:n,unsafeLadder(o,s){let i=e.ZERO,c=o;for(;s>Kr;)s&it&&(i=i.add(c)),c=c.double(),s>>=it;return i},precomputeWindow(o,s){const{windows:i,windowSize:c}=r(s),a=[];let f=o,u=f;for(let l=0;l<i;l++){u=f,a.push(u);for(let g=1;g<c;g++)u=u.add(f),a.push(u);f=u.double()}return a},wNAF(o,s,i){const{windows:c,windowSize:a}=r(o);let f=e.ZERO,u=e.BASE;const l=BigInt(2**o-1),g=2**o,d=BigInt(o);for(let w=0;w<c;w++){const h=w*a;let p=Number(i&l);i>>=d,p>a&&(p-=g,i+=it);const b=h,E=h+Math.abs(p)-1,A=w%2!==0,I=p<0;p===0?u=u.add(n(A,s[b])):f=f.add(n(I,s[E]))}return{p:f,f:u}},wNAFCached(o,s,i,c){const a=o._WINDOW_SIZE||1;let f=s.get(o);return f||(f=this.precomputeWindow(o,a),a!==1&&s.set(o,c(f))),this.wNAF(a,f,i)}}}function vn(e){return Pr(e.Fp),qe(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...mn(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Wr(e){const t=vn(e);qe(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a:o}=t;if(n){if(!r.eql(o,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}const{bytesToNumberBE:Zr,hexToBytes:Dr}=Tr,be={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(e){const{Err:t}=be;if(e.length<2||e[0]!==2)throw new t("Invalid signature integer tag");const n=e[1],r=e.subarray(2,n+2);if(!n||r.length!==n)throw new t("Invalid signature integer: wrong length");if(r[0]&128)throw new t("Invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new t("Invalid signature integer: unnecessary leading zero");return{d:Zr(r),l:e.subarray(n+2)}},toSig(e){const{Err:t}=be,n=typeof e=="string"?Dr(e):e;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let r=n.length;if(r<2||n[0]!=48)throw new t("Invalid signature tag");if(n[1]!==r-2)throw new t("Invalid signature: incorrect length");const{d:o,l:s}=be._parseInt(n.subarray(2)),{d:i,l:c}=be._parseInt(s);if(c.length)throw new t("Invalid signature: left bytes after parsing");return{r:o,s:i}},hexFromSig(e){const t=f=>Number.parseInt(f[0],16)&8?"00"+f:f,n=f=>{const u=f.toString(16);return u.length&1?`0${u}`:u},r=t(n(e.s)),o=t(n(e.r)),s=r.length/2,i=o.length/2,c=n(s),a=n(i);return`30${n(i+s+4)}02${a}${o}02${c}${r}`}},X=BigInt(0),Z=BigInt(1);BigInt(2);const Zt=BigInt(3);BigInt(4);function Gr(e){const t=Wr(e),{Fp:n}=t,r=t.toBytes||((w,h,p)=>{const b=h.toAffine();return me(Uint8Array.from([4]),n.toBytes(b.x),n.toBytes(b.y))}),o=t.fromBytes||(w=>{const h=w.subarray(1),p=n.fromBytes(h.subarray(0,n.BYTES)),b=n.fromBytes(h.subarray(n.BYTES,2*n.BYTES));return{x:p,y:b}});function s(w){const{a:h,b:p}=t,b=n.sqr(w),E=n.mul(b,w);return n.add(n.add(E,n.mul(w,h)),p)}if(!n.eql(n.sqr(t.Gy),s(t.Gx)))throw new Error("bad generator point: equation left != right");function i(w){return typeof w=="bigint"&&X<w&&w<t.n}function c(w){if(!i(w))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function a(w){const{allowedPrivateKeyLengths:h,nByteLength:p,wrapPrivateKey:b,n:E}=t;if(h&&typeof w!="bigint"){if(w instanceof Uint8Array&&(w=Ie(w)),typeof w!="string"||!h.includes(w.length))throw new Error("Invalid key");w=w.padStart(p*2,"0")}let A;try{A=typeof w=="bigint"?w:q(P("private key",w,p))}catch{throw new Error(`private key must be ${p} bytes, hex or bigint, not ${typeof w}`)}return b&&(A=C(A,E)),c(A),A}const f=new Map;function u(w){if(!(w instanceof l))throw new Error("ProjectivePoint expected")}class l{constructor(h,p,b){if(this.px=h,this.py=p,this.pz=b,h==null||!n.isValid(h))throw new Error("x required");if(p==null||!n.isValid(p))throw new Error("y required");if(b==null||!n.isValid(b))throw new Error("z required")}static fromAffine(h){const{x:p,y:b}=h||{};if(!h||!n.isValid(p)||!n.isValid(b))throw new Error("invalid affine point");if(h instanceof l)throw new Error("projective point not allowed");const E=A=>n.eql(A,n.ZERO);return E(p)&&E(b)?l.ZERO:new l(p,b,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(h){const p=n.invertBatch(h.map(b=>b.pz));return h.map((b,E)=>b.toAffine(p[E])).map(l.fromAffine)}static fromHex(h){const p=l.fromAffine(o(P("pointHex",h)));return p.assertValidity(),p}static fromPrivateKey(h){return l.BASE.multiply(a(h))}_setWindowSize(h){this._WINDOW_SIZE=h,f.delete(this)}assertValidity(){if(this.is0()){if(t.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:h,y:p}=this.toAffine();if(!n.isValid(h)||!n.isValid(p))throw new Error("bad point: x or y not FE");const b=n.sqr(p),E=s(h);if(!n.eql(b,E))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:h}=this.toAffine();if(n.isOdd)return!n.isOdd(h);throw new Error("Field doesn't support isOdd")}equals(h){u(h);const{px:p,py:b,pz:E}=this,{px:A,py:I,pz:$}=h,x=n.eql(n.mul(p,$),n.mul(A,E)),_=n.eql(n.mul(b,$),n.mul(I,E));return x&&_}negate(){return new l(this.px,n.neg(this.py),this.pz)}double(){const{a:h,b:p}=t,b=n.mul(p,Zt),{px:E,py:A,pz:I}=this;let $=n.ZERO,x=n.ZERO,_=n.ZERO,S=n.mul(E,E),V=n.mul(A,A),U=n.mul(I,I),L=n.mul(E,A);return L=n.add(L,L),_=n.mul(E,I),_=n.add(_,_),$=n.mul(h,_),x=n.mul(b,U),x=n.add($,x),$=n.sub(V,x),x=n.add(V,x),x=n.mul($,x),$=n.mul(L,$),_=n.mul(b,_),U=n.mul(h,U),L=n.sub(S,U),L=n.mul(h,L),L=n.add(L,_),_=n.add(S,S),S=n.add(_,S),S=n.add(S,U),S=n.mul(S,L),x=n.add(x,S),U=n.mul(A,I),U=n.add(U,U),S=n.mul(U,L),$=n.sub($,S),_=n.mul(U,V),_=n.add(_,_),_=n.add(_,_),new l($,x,_)}add(h){u(h);const{px:p,py:b,pz:E}=this,{px:A,py:I,pz:$}=h;let x=n.ZERO,_=n.ZERO,S=n.ZERO;const V=t.a,U=n.mul(t.b,Zt);let L=n.mul(p,A),z=n.mul(b,I),M=n.mul(E,$),oe=n.add(p,b),y=n.add(A,I);oe=n.mul(oe,y),y=n.add(L,z),oe=n.sub(oe,y),y=n.add(p,E);let m=n.add(A,$);return y=n.mul(y,m),m=n.add(L,M),y=n.sub(y,m),m=n.add(b,E),x=n.add(I,$),m=n.mul(m,x),x=n.add(z,M),m=n.sub(m,x),S=n.mul(V,y),x=n.mul(U,M),S=n.add(x,S),x=n.sub(z,S),S=n.add(z,S),_=n.mul(x,S),z=n.add(L,L),z=n.add(z,L),M=n.mul(V,M),y=n.mul(U,y),z=n.add(z,M),M=n.sub(L,M),M=n.mul(V,M),y=n.add(y,M),L=n.mul(z,y),_=n.add(_,L),L=n.mul(m,y),x=n.mul(oe,x),x=n.sub(x,L),L=n.mul(oe,z),S=n.mul(m,S),S=n.add(S,L),new l(x,_,S)}subtract(h){return this.add(h.negate())}is0(){return this.equals(l.ZERO)}wNAF(h){return d.wNAFCached(this,f,h,p=>{const b=n.invertBatch(p.map(E=>E.pz));return p.map((E,A)=>E.toAffine(b[A])).map(l.fromAffine)})}multiplyUnsafe(h){const p=l.ZERO;if(h===X)return p;if(c(h),h===Z)return this;const{endo:b}=t;if(!b)return d.unsafeLadder(this,h);let{k1neg:E,k1:A,k2neg:I,k2:$}=b.splitScalar(h),x=p,_=p,S=this;for(;A>X||$>X;)A&Z&&(x=x.add(S)),$&Z&&(_=_.add(S)),S=S.double(),A>>=Z,$>>=Z;return E&&(x=x.negate()),I&&(_=_.negate()),_=new l(n.mul(_.px,b.beta),_.py,_.pz),x.add(_)}multiply(h){c(h);let p=h,b,E;const{endo:A}=t;if(A){const{k1neg:I,k1:$,k2neg:x,k2:_}=A.splitScalar(p);let{p:S,f:V}=this.wNAF($),{p:U,f:L}=this.wNAF(_);S=d.constTimeNegate(I,S),U=d.constTimeNegate(x,U),U=new l(n.mul(U.px,A.beta),U.py,U.pz),b=S.add(U),E=V.add(L)}else{const{p:I,f:$}=this.wNAF(p);b=I,E=$}return l.normalizeZ([b,E])[0]}multiplyAndAddUnsafe(h,p,b){const E=l.BASE,A=($,x)=>x===X||x===Z||!$.equals(E)?$.multiplyUnsafe(x):$.multiply(x),I=A(this,p).add(A(h,b));return I.is0()?void 0:I}toAffine(h){const{px:p,py:b,pz:E}=this,A=this.is0();h==null&&(h=A?n.ONE:n.inv(E));const I=n.mul(p,h),$=n.mul(b,h),x=n.mul(E,h);if(A)return{x:n.ZERO,y:n.ZERO};if(!n.eql(x,n.ONE))throw new Error("invZ was invalid");return{x:I,y:$}}isTorsionFree(){const{h,isTorsionFree:p}=t;if(h===Z)return!0;if(p)return p(l,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h,clearCofactor:p}=t;return h===Z?this:p?p(l,this):this.multiplyUnsafe(t.h)}toRawBytes(h=!0){return this.assertValidity(),r(l,this,h)}toHex(h=!0){return Ie(this.toRawBytes(h))}}l.BASE=new l(t.Gx,t.Gy,n.ONE),l.ZERO=new l(n.ZERO,n.ONE,n.ZERO);const g=t.nBitLength,d=Vr(l,t.endo?Math.ceil(g/2):g);return{CURVE:t,ProjectivePoint:l,normPrivateKeyToScalar:a,weierstrassEquation:s,isWithinCurveOrder:i}}function Fr(e){const t=vn(e);return qe(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}function Yr(e){const t=Fr(e),{Fp:n,n:r}=t,o=n.BYTES+1,s=2*n.BYTES+1;function i(y){return X<y&&y<n.ORDER}function c(y){return C(y,r)}function a(y){return pt(y,r)}const{ProjectivePoint:f,normPrivateKeyToScalar:u,weierstrassEquation:l,isWithinCurveOrder:g}=Gr({...t,toBytes(y,m,B){const T=m.toAffine(),O=n.toBytes(T.x),H=me;return B?H(Uint8Array.from([m.hasEvenY()?2:3]),O):H(Uint8Array.from([4]),O,n.toBytes(T.y))},fromBytes(y){const m=y.length,B=y[0],T=y.subarray(1);if(m===o&&(B===2||B===3)){const O=q(T);if(!i(O))throw new Error("Point is not on curve");const H=l(O);let j=n.sqrt(H);const K=(j&Z)===Z;return(B&1)===1!==K&&(j=n.neg(j)),{x:O,y:j}}else if(m===s&&B===4){const O=n.fromBytes(T.subarray(0,n.BYTES)),H=n.fromBytes(T.subarray(n.BYTES,2*n.BYTES));return{x:O,y:H}}else throw new Error(`Point of length ${m} was invalid. Expected ${o} compressed bytes or ${s} uncompressed bytes`)}}),d=y=>Ie(de(y,t.nByteLength));function w(y){const m=r>>Z;return y>m}function h(y){return w(y)?c(-y):y}const p=(y,m,B)=>q(y.slice(m,B));class b{constructor(m,B,T){this.r=m,this.s=B,this.recovery=T,this.assertValidity()}static fromCompact(m){const B=t.nByteLength;return m=P("compactSignature",m,B*2),new b(p(m,0,B),p(m,B,2*B))}static fromDER(m){const{r:B,s:T}=be.toSig(P("DER",m));return new b(B,T)}assertValidity(){if(!g(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!g(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(m){return new b(this.r,this.s,m)}recoverPublicKey(m){const{r:B,s:T,recovery:O}=this,H=_(P("msgHash",m));if(O==null||![0,1,2,3].includes(O))throw new Error("recovery id invalid");const j=O===2||O===3?B+t.n:B;if(j>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const K=O&1?"03":"02",se=f.fromHex(K+d(j)),ie=a(j),Ee=c(-H*ie),Te=c(T*ie),ce=f.BASE.multiplyAndAddUnsafe(se,Ee,Te);if(!ce)throw new Error("point at infinify");return ce.assertValidity(),ce}hasHighS(){return w(this.s)}normalizeS(){return this.hasHighS()?new b(this.r,c(-this.s),this.recovery):this}toDERRawBytes(){return Le(this.toDERHex())}toDERHex(){return be.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Le(this.toCompactHex())}toCompactHex(){return d(this.r)+d(this.s)}}const E={isValidPrivateKey(y){try{return u(y),!0}catch{return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{const y=xn(t.n);return jr(t.randomBytes(y),t.n)},precompute(y=8,m=f.BASE){return m._setWindowSize(y),m.multiply(BigInt(3)),m}};function A(y,m=!0){return f.fromPrivateKey(y).toRawBytes(m)}function I(y){const m=y instanceof Uint8Array,B=typeof y=="string",T=(m||B)&&y.length;return m?T===o||T===s:B?T===2*o||T===2*s:y instanceof f}function $(y,m,B=!0){if(I(y))throw new Error("first arg must be private key");if(!I(m))throw new Error("second arg must be public key");return f.fromHex(m).multiply(u(y)).toRawBytes(B)}const x=t.bits2int||function(y){const m=q(y),B=y.length*8-t.nBitLength;return B>0?m>>BigInt(B):m},_=t.bits2int_modN||function(y){return c(x(y))},S=Lt(t.nBitLength);function V(y){if(typeof y!="bigint")throw new Error("bigint expected");if(!(X<=y&&y<S))throw new Error(`bigint expected < 2^${t.nBitLength}`);return de(y,t.nByteLength)}function U(y,m,B=L){if(["recovered","canonical"].some(we=>we in B))throw new Error("sign() legacy options not supported");const{hash:T,randomBytes:O}=t;let{lowS:H,prehash:j,extraEntropy:K}=B;H==null&&(H=!0),y=P("msgHash",y),j&&(y=P("prehashed msgHash",T(y)));const se=_(y),ie=u(m),Ee=[V(ie),V(se)];if(K!=null){const we=K===!0?O(n.BYTES):K;Ee.push(P("extraEntropy",we))}const Te=me(...Ee),ce=se;function tt(we){const xe=x(we);if(!g(xe))return;const Ht=a(xe),ve=f.BASE.multiply(xe).toAffine(),D=c(ve.x);if(D===X)return;const _e=c(Ht*c(ce+D*ie));if(_e===X)return;let Rt=(ve.x===D?0:2)|Number(ve.y&Z),Ct=_e;return H&&w(_e)&&(Ct=h(_e),Rt^=1),new b(D,Ct,Rt)}return{seed:Te,k2sig:tt}}const L={lowS:t.lowS,prehash:!1},z={lowS:t.lowS,prehash:!1};function M(y,m,B=L){const{seed:T,k2sig:O}=U(y,m,B),H=t;return bn(H.hash.outputLen,H.nByteLength,H.hmac)(T,O)}f.BASE._setWindowSize(8);function oe(y,m,B,T=z){var ve;const O=y;if(m=P("msgHash",m),B=P("publicKey",B),"strict"in T)throw new Error("options.strict was renamed to lowS");const{lowS:H,prehash:j}=T;let K,se;try{if(typeof O=="string"||O instanceof Uint8Array)try{K=b.fromDER(O)}catch(D){if(!(D instanceof be.Err))throw D;K=b.fromCompact(O)}else if(typeof O=="object"&&typeof O.r=="bigint"&&typeof O.s=="bigint"){const{r:D,s:_e}=O;K=new b(D,_e)}else throw new Error("PARSE");se=f.fromHex(B)}catch(D){if(D.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(H&&K.hasHighS())return!1;j&&(m=t.hash(m));const{r:ie,s:Ee}=K,Te=_(m),ce=a(Ee),tt=c(Te*ce),we=c(ie*ce),xe=(ve=f.BASE.multiplyAndAddUnsafe(se,tt,we))==null?void 0:ve.toAffine();return xe?c(xe.x)===ie:!1}return{CURVE:t,getPublicKey:A,getSharedSecret:$,sign:M,verify:oe,ProjectivePoint:f,Signature:b,utils:E}}class _n extends gn{constructor(t,n){super(),this.finished=!1,this.destroyed=!1,ur(t);const r=St(n);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const o=this.blockLen,s=new Uint8Array(o);s.set(r.length>o?t.create().update(r).digest():r);for(let i=0;i<s.length;i++)s[i]^=54;this.iHash.update(s),this.oHash=t.create();for(let i=0;i<s.length;i++)s[i]^=106;this.oHash.update(s),s.fill(0)}update(t){return je(this),this.iHash.update(t),this}digestInto(t){je(this),hn(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:o,destroyed:s,blockLen:i,outputLen:c}=this;return t=t,t.finished=o,t.destroyed=s,t.blockLen=i,t.outputLen=c,t.oHash=n._cloneInto(t.oHash),t.iHash=r._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const An=(e,t,n)=>new _n(e,t).update(n).digest();An.create=(e,t)=>new _n(e,t);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Jr(e){return{hash:e,hmac:(t,...n)=>An(e,t,wr(...n)),randomBytes:wn}}function Qr(e,t){const n=r=>Yr({...e,...Jr(r)});return Object.freeze({...n(t),create:n})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Ye=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Ke=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Bn=BigInt(1),Ve=BigInt(2),Dt=(e,t)=>(e+t/Ve)/t;function Sn(e){const t=Ye,n=BigInt(3),r=BigInt(6),o=BigInt(11),s=BigInt(22),i=BigInt(23),c=BigInt(44),a=BigInt(88),f=e*e*e%t,u=f*f*e%t,l=W(u,n,t)*u%t,g=W(l,n,t)*u%t,d=W(g,Ve,t)*f%t,w=W(d,o,t)*d%t,h=W(w,s,t)*w%t,p=W(h,c,t)*h%t,b=W(p,a,t)*p%t,E=W(b,c,t)*h%t,A=W(E,n,t)*u%t,I=W(A,i,t)*w%t,$=W(I,r,t)*f%t,x=W($,Ve,t);if(!yt.eql(yt.sqr(x),e))throw new Error("Cannot find square root");return x}const yt=Mr(Ye,void 0,void 0,{sqrt:Sn}),Ot=Qr({a:BigInt(0),b:BigInt(7),Fp:yt,n:Ke,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{const t=Ke,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-Bn*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=n,i=BigInt("0x100000000000000000000000000000000"),c=Dt(s*e,t),a=Dt(-r*e,t);let f=C(e-c*n-a*o,t),u=C(-c*r-a*s,t);const l=f>i,g=u>i;if(l&&(f=t-f),g&&(u=t-u),f>i||u>i)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:l,k1:f,k2neg:g,k2:u}}}},gt),Je=BigInt(0),$n=e=>typeof e=="bigint"&&Je<e&&e<Ye,Xr=e=>typeof e=="bigint"&&Je<e&&e<Ke,Gt={};function We(e,...t){let n=Gt[e];if(n===void 0){const r=gt(Uint8Array.from(e,o=>o.charCodeAt(0)));n=me(r,r),Gt[e]=n}return gt(me(n,...t))}const Tt=e=>e.toRawBytes(!0).slice(1),bt=e=>de(e,32),ct=e=>C(e,Ye),Pe=e=>C(e,Ke),Ut=Ot.ProjectivePoint,eo=(e,t,n)=>Ut.BASE.multiplyAndAddUnsafe(e,t,n);function mt(e){let t=Ot.utils.normPrivateKeyToScalar(e),n=Ut.fromPrivateKey(t);return{scalar:n.hasEvenY()?t:Pe(-t),bytes:Tt(n)}}function kn(e){if(!$n(e))throw new Error("bad x: need 0 < x < p");const t=ct(e*e),n=ct(t*e+BigInt(7));let r=Sn(n);r%Ve!==Je&&(r=ct(-r));const o=new Ut(e,r,Bn);return o.assertValidity(),o}function In(...e){return Pe(q(We("BIP0340/challenge",...e)))}function to(e){return mt(e).bytes}function no(e,t,n=wn(32)){const r=P("message",e),{bytes:o,scalar:s}=mt(t),i=P("auxRand",n,32),c=bt(s^q(We("BIP0340/aux",i))),a=We("BIP0340/nonce",c,o,r),f=Pe(q(a));if(f===Je)throw new Error("sign failed: k is zero");const{bytes:u,scalar:l}=mt(f),g=In(u,o,r),d=new Uint8Array(64);if(d.set(u,0),d.set(bt(Pe(l+g*s)),32),!Ln(d,r,o))throw new Error("sign: Invalid signature produced");return d}function Ln(e,t,n){const r=P("signature",e,64),o=P("message",t),s=P("publicKey",n,32);try{const i=kn(q(s)),c=q(r.subarray(0,32));if(!$n(c))return!1;const a=q(r.subarray(32,64));if(!Xr(a))return!1;const f=In(bt(c),Tt(i),o),u=eo(i,a,Pe(-f));return!(!u||!u.hasEvenY()||u.toAffine().x!==c)}catch{return!1}}const J={getPublicKey:to,sign:no,verify:Ln,utils:{randomPrivateKey:Ot.utils.randomPrivateKey,lift_x:kn,pointToBytes:Tt,numberToBytesBE:de,bytesToNumberBE:q,taggedHash:We,mod:C}};/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const On=e=>e instanceof Uint8Array,at=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),Y=(e,t)=>e<<32-t|e>>>t,ro=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!ro)throw new Error("Non little-endian hardware is not supported");const oo=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function he(e){if(!On(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=oo[e[n]];return t}function so(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);const t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(t/2);for(let r=0;r<n.length;r++){const o=r*2,s=e.slice(o,o+2),i=Number.parseInt(s,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");n[r]=i}return n}function io(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function Tn(e){if(typeof e=="string"&&(e=io(e)),!On(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}class co{clone(){return this._cloneInto()}}function Un(e){const t=r=>e().update(Tn(r)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function Et(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function ao(e){if(typeof e!="boolean")throw new Error(`Expected boolean, not ${e}`)}function Nn(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function fo(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Et(e.outputLen),Et(e.blockLen)}function lo(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function uo(e,t){Nn(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const ft={number:Et,bool:ao,bytes:Nn,hash:fo,exists:lo,output:uo};function ho(e,t,n,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,r);const o=BigInt(32),s=BigInt(4294967295),i=Number(n>>o&s),c=Number(n&s),a=r?4:0,f=r?0:4;e.setUint32(t+a,i,r),e.setUint32(t+f,c,r)}class go extends co{constructor(t,n,r,o){super(),this.blockLen=t,this.outputLen=n,this.padOffset=r,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=at(this.buffer)}update(t){ft.exists(this);const{view:n,buffer:r,blockLen:o}=this;t=Tn(t);const s=t.length;for(let i=0;i<s;){const c=Math.min(o-this.pos,s-i);if(c===o){const a=at(t);for(;o<=s-i;i+=o)this.process(a,i);continue}r.set(t.subarray(i,i+c),this.pos),this.pos+=c,i+=c,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){ft.exists(this),ft.output(t,this),this.finished=!0;const{buffer:n,view:r,blockLen:o,isLE:s}=this;let{pos:i}=this;n[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>o-i&&(this.process(r,0),i=0);for(let l=i;l<o;l++)n[l]=0;ho(r,o-8,BigInt(this.length*8),s),this.process(r,0);const c=at(t),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const f=a/4,u=this.get();if(f>u.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<f;l++)c.setUint32(4*l,u[l],s)}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const r=t.slice(0,n);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:n,buffer:r,length:o,finished:s,destroyed:i,pos:c}=this;return t.length=o,t.pos=c,t.finished=s,t.destroyed=i,o%n&&t.buffer.set(r),t}}const wo=(e,t,n)=>e&t^~e&n,po=(e,t,n)=>e&t^e&n^t&n,yo=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),le=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ue=new Uint32Array(64);class Hn extends go{constructor(){super(64,32,8,!1),this.A=le[0]|0,this.B=le[1]|0,this.C=le[2]|0,this.D=le[3]|0,this.E=le[4]|0,this.F=le[5]|0,this.G=le[6]|0,this.H=le[7]|0}get(){const{A:t,B:n,C:r,D:o,E:s,F:i,G:c,H:a}=this;return[t,n,r,o,s,i,c,a]}set(t,n,r,o,s,i,c,a){this.A=t|0,this.B=n|0,this.C=r|0,this.D=o|0,this.E=s|0,this.F=i|0,this.G=c|0,this.H=a|0}process(t,n){for(let l=0;l<16;l++,n+=4)ue[l]=t.getUint32(n,!1);for(let l=16;l<64;l++){const g=ue[l-15],d=ue[l-2],w=Y(g,7)^Y(g,18)^g>>>3,h=Y(d,17)^Y(d,19)^d>>>10;ue[l]=h+ue[l-7]+w+ue[l-16]|0}let{A:r,B:o,C:s,D:i,E:c,F:a,G:f,H:u}=this;for(let l=0;l<64;l++){const g=Y(c,6)^Y(c,11)^Y(c,25),d=u+g+wo(c,a,f)+yo[l]+ue[l]|0,h=(Y(r,2)^Y(r,13)^Y(r,22))+po(r,o,s)|0;u=f,f=a,a=c,c=i+d|0,i=s,s=o,o=r,r=d+h|0}r=r+this.A|0,o=o+this.B|0,s=s+this.C|0,i=i+this.D|0,c=c+this.E|0,a=a+this.F|0,f=f+this.G|0,u=u+this.H|0,this.set(r,o,s,i,c,a,f,u)}roundClean(){ue.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class bo extends Hn{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const Rn=Un(()=>new Hn);Un(()=>new bo);var pe=Symbol("verified"),mo=e=>e instanceof Object;function Eo(e){if(!mo(e)||typeof e.kind!="number"||typeof e.content!="string"||typeof e.created_at!="number"||typeof e.pubkey!="string"||!e.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(e.tags))return!1;for(let t=0;t<e.tags.length;t++){let n=e.tags[t];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]=="object")return!1}return!0}new TextDecoder("utf-8");var xo=new TextEncoder;function Ne(e){e.indexOf("://")===-1&&(e="wss://"+e);let t=new URL(e);return t.pathname=t.pathname.replace(/\/+/g,"/"),t.pathname.endsWith("/")&&(t.pathname=t.pathname.slice(0,-1)),(t.port==="80"&&t.protocol==="ws:"||t.port==="443"&&t.protocol==="wss:")&&(t.port=""),t.searchParams.sort(),t.hash="",t.toString()}var vo=class{constructor(e){v(this,"value");v(this,"next",null);v(this,"prev",null);this.value=e}},_o=class{constructor(){v(this,"first");v(this,"last");this.first=null,this.last=null}enqueue(e){const t=new vo(e);return this.last?this.last===this.first?(this.last=t,this.last.prev=this.first,this.first.next=t):(t.prev=this.last,this.last.next=t,this.last=t):(this.first=t,this.last=t),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const t=this.first;return this.first=null,this.last=null,t.value}const e=this.first;return this.first=e.next,e.value}},Ao=class{generateSecretKey(){return J.utils.randomPrivateKey()}getPublicKey(t){return he(J.getPublicKey(t))}finalizeEvent(t,n){const r=t;return r.pubkey=he(J.getPublicKey(n)),r.id=lt(r),r.sig=he(J.sign(lt(r),n)),r[pe]=!0,r}verifyEvent(t){if(typeof t[pe]=="boolean")return t[pe];const n=lt(t);if(n!==t.id)return t[pe]=!1,!1;try{const r=J.verify(t.sig,n,t.pubkey);return t[pe]=r,r}catch{return t[pe]=!1,!1}}};function Bo(e){if(!Eo(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}function lt(e){let t=Rn(xo.encode(Bo(e)));return he(t)}var Qe=new Ao;Qe.generateSecretKey;Qe.getPublicKey;Qe.finalizeEvent;var So=Qe.verifyEvent,$o=22242;function ko(e,t){if(e.ids&&e.ids.indexOf(t.id)===-1||e.kinds&&e.kinds.indexOf(t.kind)===-1||e.authors&&e.authors.indexOf(t.pubkey)===-1)return!1;for(let n in e)if(n[0]==="#"){let r=n.slice(1),o=e[`#${r}`];if(o&&!t.tags.find(([s,i])=>s===n.slice(1)&&o.indexOf(i)!==-1))return!1}return!(e.since&&t.created_at<e.since||e.until&&t.created_at>e.until)}function Io(e,t){for(let n=0;n<e.length;n++)if(ko(e[n],t))return!0;return!1}function Lo(e,t){let n=t.length+3,r=e.indexOf(`"${t}":`)+n,o=e.slice(r).indexOf('"')+r+1;return e.slice(o,o+64)}function Oo(e){let t=e.slice(0,22).indexOf('"EVENT"');if(t===-1)return null;let n=e.slice(t+7+1).indexOf('"');if(n===-1)return null;let r=t+7+1+n,o=e.slice(r+1,80).indexOf('"');if(o===-1)return null;let s=r+1+o;return e.slice(r+1,s)}function To(e,t){return{kind:$o,created_at:Math.floor(Date.now()/1e3),tags:[["relay",e],["challenge",t]],content:""}}async function Uo(){return new Promise(e=>{const t=new MessageChannel,n=()=>{t.port1.removeEventListener("message",n),e()};t.port1.addEventListener("message",n),t.port2.postMessage(0),t.port1.start()})}var No=e=>(e[pe]=!0,!0),Cn=class{constructor(e,t){v(this,"url");v(this,"_connected",!1);v(this,"onclose",null);v(this,"onnotice",e=>console.debug(`NOTICE from ${this.url}: ${e}`));v(this,"_onauth",null);v(this,"baseEoseTimeout",4400);v(this,"connectionTimeout",4400);v(this,"openSubs",new Map);v(this,"connectionTimeoutHandle");v(this,"connectionPromise");v(this,"openCountRequests",new Map);v(this,"openEventPublishes",new Map);v(this,"ws");v(this,"incomingMessageQueue",new _o);v(this,"queueRunning",!1);v(this,"challenge");v(this,"serial",0);v(this,"verifyEvent");v(this,"_WebSocket");this.url=Ne(e),this.verifyEvent=t.verifyEvent,this._WebSocket=t.websocketImplementation||WebSocket}static async connect(e,t){const n=new Cn(e,t);return await n.connect(),n}closeAllSubscriptions(e){for(let[t,n]of this.openSubs)n.close(e);this.openSubs.clear();for(let[t,n]of this.openEventPublishes)n.reject(new Error(e));this.openEventPublishes.clear();for(let[t,n]of this.openCountRequests)n.reject(new Error(e));this.openCountRequests.clear()}get connected(){return this._connected}async connect(){return this.connectionPromise?this.connectionPromise:(this.challenge=void 0,this.connectionPromise=new Promise((e,t)=>{this.connectionTimeoutHandle=setTimeout(()=>{var n;t("connection timed out"),this.connectionPromise=void 0,(n=this.onclose)==null||n.call(this),this.closeAllSubscriptions("relay connection timed out")},this.connectionTimeout);try{this.ws=new this._WebSocket(this.url)}catch(n){t(n);return}this.ws.onopen=()=>{clearTimeout(this.connectionTimeoutHandle),this._connected=!0,e()},this.ws.onerror=n=>{var r;t(n.message||"websocket error"),this._connected&&(this._connected=!1,this.connectionPromise=void 0,(r=this.onclose)==null||r.call(this),this.closeAllSubscriptions("relay connection errored"))},this.ws.onclose=async()=>{var n;this._connected&&(this._connected=!1,this.connectionPromise=void 0,(n=this.onclose)==null||n.call(this),this.closeAllSubscriptions("relay connection closed"))},this.ws.onmessage=this._onmessage.bind(this)}),this.connectionPromise)}async runQueue(){for(this.queueRunning=!0;this.handleNext()!==!1;)await Uo();this.queueRunning=!1}handleNext(){var n,r,o;const e=this.incomingMessageQueue.dequeue();if(!e)return!1;const t=Oo(e);if(t){const s=this.openSubs.get(t);if(!s)return;const i=Lo(e,"id"),c=(n=s.alreadyHaveEvent)==null?void 0:n.call(s,i);if((r=s.receivedEvent)==null||r.call(s,this,i),c)return}try{let s=JSON.parse(e);switch(s[0]){case"EVENT":{const i=this.openSubs.get(s[1]),c=s[2];this.verifyEvent(c)&&Io(i.filters,c)&&i.onevent(c);return}case"COUNT":{const i=s[1],c=s[2],a=this.openCountRequests.get(i);a&&(a.resolve(c.count),this.openCountRequests.delete(i));return}case"EOSE":{const i=this.openSubs.get(s[1]);if(!i)return;i.receivedEose();return}case"OK":{const i=s[1],c=s[2],a=s[3],f=this.openEventPublishes.get(i);c?f.resolve(a):f.reject(new Error(a)),this.openEventPublishes.delete(i);return}case"CLOSED":{const i=s[1],c=this.openSubs.get(i);if(!c)return;c.closed=!0,c.close(s[2]);return}case"NOTICE":this.onnotice(s[1]);return;case"AUTH":{this.challenge=s[1],(o=this._onauth)==null||o.call(this,s[1]);return}}}catch{return}}async send(e){if(!this.connectionPromise)throw new Error("sending on closed connection");this.connectionPromise.then(()=>{var t;(t=this.ws)==null||t.send(e)})}async auth(e){if(!this.challenge)throw new Error("can't perform auth, no challenge was received");const t=await e(To(this.url,this.challenge)),n=new Promise((r,o)=>{this.openEventPublishes.set(t.id,{resolve:r,reject:o})});return this.send('["AUTH",'+JSON.stringify(t)+"]"),n}async publish(e){const t=new Promise((n,r)=>{this.openEventPublishes.set(e.id,{resolve:n,reject:r})});return this.send('["EVENT",'+JSON.stringify(e)+"]"),t}async count(e,t){this.serial++;const n=(t==null?void 0:t.id)||"count:"+this.serial,r=new Promise((o,s)=>{this.openCountRequests.set(n,{resolve:o,reject:s})});return this.send('["COUNT","'+n+'",'+JSON.stringify(e).substring(1)),r}subscribe(e,t){const n=this.prepareSubscription(e,t);return n.fire(),n}prepareSubscription(e,t){this.serial++;const n=t.id||"sub:"+this.serial,r=new Ho(this,n,e,t);return this.openSubs.set(n,r),r}close(){var e;this.closeAllSubscriptions("relay connection closed by us"),this._connected=!1,(e=this.ws)==null||e.close()}_onmessage(e){this.incomingMessageQueue.enqueue(e.data),this.queueRunning||this.runQueue()}},Ho=class{constructor(e,t,n,r){v(this,"relay");v(this,"id");v(this,"closed",!1);v(this,"eosed",!1);v(this,"filters");v(this,"alreadyHaveEvent");v(this,"receivedEvent");v(this,"onevent");v(this,"oneose");v(this,"onclose");v(this,"eoseTimeout");v(this,"eoseTimeoutHandle");this.relay=e,this.filters=n,this.id=t,this.alreadyHaveEvent=r.alreadyHaveEvent,this.receivedEvent=r.receivedEvent,this.eoseTimeout=r.eoseTimeout||e.baseEoseTimeout,this.oneose=r.oneose,this.onclose=r.onclose,this.onevent=r.onevent||(o=>{console.warn(`onevent() callback not defined for subscription '${this.id}' in relay ${this.relay.url}. event received:`,o)})}fire(){this.relay.send('["REQ","'+this.id+'",'+JSON.stringify(this.filters).substring(1)),this.eoseTimeoutHandle=setTimeout(this.receivedEose.bind(this),this.eoseTimeout)}receivedEose(){var e;this.eosed||(clearTimeout(this.eoseTimeoutHandle),this.eosed=!0,(e=this.oneose)==null||e.call(this))}close(e="closed by caller"){var t;!this.closed&&this.relay.connected&&(this.relay.send('["CLOSE",'+JSON.stringify(this.id)+"]"),this.closed=!0),this.relay.openSubs.delete(this.id),(t=this.onclose)==null||t.call(this,e)}},Ro=class{constructor(e){v(this,"relays",new Map);v(this,"seenOn",new Map);v(this,"trackRelays",!1);v(this,"verifyEvent");v(this,"trustedRelayURLs",new Set);v(this,"_WebSocket");this.verifyEvent=e.verifyEvent,this._WebSocket=e.websocketImplementation}async ensureRelay(e,t){e=Ne(e);let n=this.relays.get(e);return n||(n=new Cn(e,{verifyEvent:this.trustedRelayURLs.has(e)?No:this.verifyEvent,websocketImplementation:this._WebSocket}),t!=null&&t.connectionTimeout&&(n.connectionTimeout=t.connectionTimeout),this.relays.set(e,n)),await n.connect(),n}close(e){e.map(Ne).forEach(t=>{var n;(n=this.relays.get(t))==null||n.close()})}subscribeMany(e,t,n){return this.subscribeManyMap(Object.fromEntries(e.map(r=>[r,t])),n)}subscribeManyMap(e,t){this.trackRelays&&(t.receivedEvent=(l,g)=>{let d=this.seenOn.get(g);d||(d=new Set,this.seenOn.set(g,d)),d.add(l)});const n=new Set,r=[],o=Object.keys(e).length,s=[];let i=l=>{var g;s[l]=!0,s.filter(d=>d).length===o&&((g=t.oneose)==null||g.call(t),i=()=>{})};const c=[];let a=(l,g)=>{var d;i(l),c[l]=g,c.filter(w=>w).length===o&&((d=t.onclose)==null||d.call(t,c),a=()=>{})};const f=l=>{var d;if((d=t.alreadyHaveEvent)!=null&&d.call(t,l))return!0;const g=n.has(l);return n.add(l),g},u=Promise.all(Object.entries(e).map(async(l,g,d)=>{if(d.indexOf(l)!==g){a(g,"duplicate url");return}let[w,h]=l;w=Ne(w);let p;try{p=await this.ensureRelay(w,{connectionTimeout:t.maxWait?Math.max(t.maxWait*.8,t.maxWait-1e3):void 0})}catch(E){a(g,(E==null?void 0:E.message)||String(E));return}let b=p.subscribe(h,{...t,oneose:()=>i(g),onclose:E=>a(g,E),alreadyHaveEvent:f,eoseTimeout:t.maxWait});r.push(b)}));return{async close(){await u,r.forEach(l=>{l.close()})}}}subscribeManyEose(e,t,n){const r=this.subscribeMany(e,t,{...n,oneose(){r.close()}});return r}async querySync(e,t,n){return new Promise(async r=>{const o=[];this.subscribeManyEose(e,[t],{...n,onevent(s){o.push(s)},onclose(s){r(o)}})})}async get(e,t,n){t.limit=1;const r=await this.querySync(e,t,n);return r.sort((o,s)=>s.created_at-o.created_at),r[0]||null}publish(e,t){return e.map(Ne).map(async(n,r,o)=>o.indexOf(n)!==r?Promise.reject("duplicate url"):(await this.ensureRelay(n)).publish(t))}},Pn;try{Pn=WebSocket}catch{}var Co=class extends Ro{constructor(){super({verifyEvent:So,websocketImplementation:Pn})}};new TextDecoder("utf-8");new TextEncoder;function Po(e){e.indexOf("://")===-1&&(e="wss://"+e);let t=new URL(e);return t.pathname=t.pathname.replace(/\/+/g,"/"),t.pathname.endsWith("/")&&(t.pathname=t.pathname.slice(0,-1)),(t.port==="80"&&t.protocol==="ws:"||t.port==="443"&&t.protocol==="wss:")&&(t.port=""),t.searchParams.sort(),t.hash="",t.toString()}function qo(e,t){const[n,r]=zo(e,o=>t.id===o.id?0:t.created_at===o.created_at?-1:t.created_at-o.created_at);return r||e.splice(n,0,t),e}function zo(e,t){let n=0,r=e.length-1;for(;n<=r;){const o=Math.floor((n+r)/2),s=t(e[o]);if(s===0)return[o,!0];s<0?r=o-1:n=o+1}return[n,!1]}/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Oe(e){if(!Number.isSafeInteger(e))throw new Error(`Wrong integer: ${e}`)}function te(...e){const t=(o,s)=>i=>o(s(i)),n=Array.from(e).reverse().reduce((o,s)=>o?t(o,s.encode):s.encode,void 0),r=e.reduce((o,s)=>o?t(o,s.decode):s.decode,void 0);return{encode:n,decode:r}}function ne(e){return{encode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return t.map(n=>{if(Oe(n),n<0||n>=e.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${e.length})`);return e[n]})},decode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("alphabet.decode input should be array of strings");return t.map(n=>{if(typeof n!="string")throw new Error(`alphabet.decode: not string element=${n}`);const r=e.indexOf(n);if(r===-1)throw new Error(`Unknown letter: "${n}". Allowed: ${e}`);return r})}}}function re(e=""){if(typeof e!="string")throw new Error("join separator should be string");return{encode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("join.encode input should be array of strings");for(let n of t)if(typeof n!="string")throw new Error(`join.encode: non-string input=${n}`);return t.join(e)},decode:t=>{if(typeof t!="string")throw new Error("join.decode input should be string");return t.split(e)}}}function Xe(e,t="="){if(Oe(e),typeof t!="string")throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let r of n)if(typeof r!="string")throw new Error(`padding.encode: non-string input=${r}`);for(;n.length*e%8;)n.push(t);return n},decode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let o of n)if(typeof o!="string")throw new Error(`padding.decode: non-string input=${o}`);let r=n.length;if(r*e%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===t;r--)if(!((r-1)*e%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function qn(e){if(typeof e!="function")throw new Error("normalize fn should be function");return{encode:t=>t,decode:t=>e(t)}}function Ft(e,t,n){if(t<2)throw new Error(`convertRadix: wrong from=${t}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(e))throw new Error("convertRadix: data should be array");if(!e.length)return[];let r=0;const o=[],s=Array.from(e);for(s.forEach(i=>{if(Oe(i),i<0||i>=t)throw new Error(`Wrong integer: ${i}`)});;){let i=0,c=!0;for(let a=r;a<s.length;a++){const f=s[a],u=t*i+f;if(!Number.isSafeInteger(u)||t*i/t!==i||u-f!==t*i)throw new Error("convertRadix: carry overflow");if(i=u%n,s[a]=Math.floor(u/n),!Number.isSafeInteger(s[a])||s[a]*n+i!==u)throw new Error("convertRadix: carry overflow");if(c)s[a]?c=!1:r=a;else continue}if(o.push(i),c)break}for(let i=0;i<e.length-1&&e[i]===0;i++)o.push(0);return o.reverse()}const zn=(e,t)=>t?zn(t,e%t):e,Ze=(e,t)=>e+(t-zn(e,t));function xt(e,t,n,r){if(!Array.isArray(e))throw new Error("convertRadix2: data should be array");if(t<=0||t>32)throw new Error(`convertRadix2: wrong from=${t}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(Ze(t,n)>32)throw new Error(`convertRadix2: carry overflow from=${t} to=${n} carryBits=${Ze(t,n)}`);let o=0,s=0;const i=2**n-1,c=[];for(const a of e){if(Oe(a),a>=2**t)throw new Error(`convertRadix2: invalid data word=${a} from=${t}`);if(o=o<<t|a,s+t>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${t}`);for(s+=t;s>=n;s-=n)c.push((o>>s-n&i)>>>0);o&=2**s-1}if(o=o<<n-s&i,!r&&s>=t)throw new Error("Excess padding");if(!r&&o)throw new Error(`Non-zero padding: ${o}`);return r&&s>0&&c.push(o>>>0),c}function Mo(e){return Oe(e),{encode:t=>{if(!(t instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return Ft(Array.from(t),2**8,e)},decode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(Ft(t,e,2**8))}}}function ge(e,t=!1){if(Oe(e),e<=0||e>32)throw new Error("radix2: bits should be in (0..32]");if(Ze(8,e)>32||Ze(e,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return xt(Array.from(n),8,e,!t)},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(xt(n,e,8,t))}}}function Yt(e){if(typeof e!="function")throw new Error("unsafeWrapper fn should be function");return function(...t){try{return e.apply(null,t)}catch{}}}const jo=te(ge(4),ne("0123456789ABCDEF"),re("")),Ko=te(ge(5),ne("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),Xe(5),re(""));te(ge(5),ne("0123456789ABCDEFGHIJKLMNOPQRSTUV"),Xe(5),re(""));te(ge(5),ne("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),re(""),qn(e=>e.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const Vo=te(ge(6),ne("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),Xe(6),re("")),Wo=te(ge(6),ne("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),Xe(6),re("")),Nt=e=>te(Mo(58),ne(e),re("")),vt=Nt("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");Nt("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ");Nt("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const Jt=[0,2,3,5,6,7,9,10,11],Zo={encode(e){let t="";for(let n=0;n<e.length;n+=8){const r=e.subarray(n,n+8);t+=vt.encode(r).padStart(Jt[r.length],"1")}return t},decode(e){let t=[];for(let n=0;n<e.length;n+=11){const r=e.slice(n,n+11),o=Jt.indexOf(r.length),s=vt.decode(r);for(let i=0;i<s.length-o;i++)if(s[i]!==0)throw new Error("base58xmr: wrong padding");t=t.concat(Array.from(s.slice(s.length-o)))}return Uint8Array.from(t)}},_t=te(ne("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),re("")),Qt=[996825010,642813549,513874426,1027748829,705979059];function Ue(e){const t=e>>25;let n=(e&33554431)<<5;for(let r=0;r<Qt.length;r++)(t>>r&1)===1&&(n^=Qt[r]);return n}function Xt(e,t,n=1){const r=e.length;let o=1;for(let s=0;s<r;s++){const i=e.charCodeAt(s);if(i<33||i>126)throw new Error(`Invalid prefix (${e})`);o=Ue(o)^i>>5}o=Ue(o);for(let s=0;s<r;s++)o=Ue(o)^e.charCodeAt(s)&31;for(let s of t)o=Ue(o)^s;for(let s=0;s<6;s++)o=Ue(o);return o^=n,_t.encode(xt([o%2**30],30,5,!1))}function Mn(e){const t=e==="bech32"?1:734539939,n=ge(5),r=n.decode,o=n.encode,s=Yt(r);function i(u,l,g=90){if(typeof u!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof u}`);if(!Array.isArray(l)||l.length&&typeof l[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof l}`);const d=u.length+7+l.length;if(g!==!1&&d>g)throw new TypeError(`Length ${d} exceeds limit ${g}`);return u=u.toLowerCase(),`${u}1${_t.encode(l)}${Xt(u,l,t)}`}function c(u,l=90){if(typeof u!="string")throw new Error(`bech32.decode input should be string, not ${typeof u}`);if(u.length<8||l!==!1&&u.length>l)throw new TypeError(`Wrong string length: ${u.length} (${u}). Expected (8..${l})`);const g=u.toLowerCase();if(u!==g&&u!==u.toUpperCase())throw new Error("String must be lowercase or uppercase");u=g;const d=u.lastIndexOf("1");if(d===0||d===-1)throw new Error('Letter "1" must be present between prefix and data only');const w=u.slice(0,d),h=u.slice(d+1);if(h.length<6)throw new Error("Data must be at least 6 characters long");const p=_t.decode(h).slice(0,-6),b=Xt(w,p,t);if(!h.endsWith(b))throw new Error(`Invalid checksum in ${u}: expected "${b}"`);return{prefix:w,words:p}}const a=Yt(c);function f(u){const{prefix:l,words:g}=c(u,!1);return{prefix:l,words:g,bytes:r(g)}}return{encode:i,decode:c,decodeToBytes:f,decodeUnsafe:a,fromWords:r,fromWordsUnsafe:s,toWords:o}}const en=Mn("bech32");Mn("bech32m");const Do={encode:e=>new TextDecoder().decode(e),decode:e=>new TextEncoder().encode(e)},Go=te(ge(4),ne("0123456789abcdef"),re(""),qn(e=>{if(typeof e!="string"||e.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof e} with length ${e.length}`);return e.toLowerCase()})),Fo={utf8:Do,hex:Go,base16:jo,base32:Ko,base64:Vo,base64url:Wo,base58:vt,base58xmr:Zo};`${Object.keys(Fo).join(", ")}`;new TextDecoder("utf-8");new TextEncoder;var Yo=5e3;function jn(e){return Qo("npub",so(e))}function Jo(e,t){let n=en.toWords(t);return en.encode(e,n,Yo)}function Qo(e,t){return Jo(e,t)}var Be=Symbol("verified"),Xo=e=>e instanceof Object;function es(e){if(!Xo(e)||typeof e.kind!="number"||typeof e.content!="string"||typeof e.created_at!="number"||typeof e.pubkey!="string"||!e.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(e.tags))return!1;for(let t=0;t<e.tags.length;t++){let n=e.tags[t];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]=="object")return!1}return!0}new TextDecoder("utf-8");var ts=new TextEncoder,ns=class{generateSecretKey(){return J.utils.randomPrivateKey()}getPublicKey(e){return he(J.getPublicKey(e))}finalizeEvent(e,t){const n=e;return n.pubkey=he(J.getPublicKey(t)),n.id=ut(n),n.sig=he(J.sign(ut(n),t)),n[Be]=!0,n}verifyEvent(e){if(typeof e[Be]=="boolean")return e[Be];const t=ut(e);if(t!==e.id)return e[Be]=!1,!1;try{const n=J.verify(e.sig,t,e.pubkey);return e[Be]=n,n}catch{return e[Be]=!1,!1}}};function rs(e){if(!es(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}function ut(e){let t=Rn(ts.encode(rs(e)));return he(t)}var et=new ns,os=et.generateSecretKey;et.getPublicKey;var ss=et.finalizeEvent;et.verifyEvent;const Kn=7,tn="https://nostter.app",is=["wss://relay.mymt.casa/"],cs=["wss://purplepag.es/","wss://directory.yabu.me/"],as="",nn=e=>`https://robohash.org/${jn(e)}?set=set4`,rn=(e,t,n,r=()=>{})=>new Promise(o=>{const s=[],i=f=>{s.push(f),r(f)},c=()=>{a.close(),o(s)},a=e.subscribeMany(t,n,{onevent:i,oneose:c})}),fs=async(e,t,n,r,o=!0,s)=>{const i=[["r",n]],c={kind:Kn,created_at:Math.floor(Date.now()/1e3),tags:i,content:r};let a;if(window.nostr===void 0){if(o){console.warn("window.nostr is undefined");return}const u=os();a=ss(c,u)}else a=await window.nostr.signEvent(c);const f=e.publish(t,a);await Promise.any(f)};function on(e,t,n){const r=e.slice();r[9]=t[n];const o=r[9].tags.find(s=>s[0]==="emoji");return r[10]=o,r}function ls(e){var i;const t=e.slice(),n=t[1].get(t[9].pubkey);t[13]=n;const r=JSON.parse(((i=t[13])==null?void 0:i.content)??"{}");t[14]=r;const o=jn(t[9].pubkey);t[15]=o;const s=t[14].name??"";return t[16]=s,t}function us(e){let t,n;function r(i,c){var a;return c&1&&(n=null),n==null&&(n=i[9].content===`:${((a=i[10])==null?void 0:a.at(1))??""}:`),n?ds:hs}let o=r(e,-1),s=o(e);return{c(){t=ee("span"),s.c(),k(t,"class","makibishi-content svelte-16ydz6r")},m(i,c){Q(i,t,c),s.m(t,null)},p(i,c){o===(o=r(i,c))&&s?s.p(i,c):(s.d(1),s=o(i),s&&(s.c(),s.m(t,null)))},d(i){i&&G(t),s.d()}}}function sn(e){let t,n,r,o,s,i,c,a,f;function u(d,w){var h;return w&1&&(n=null),n==null&&(n=d[9].content===`:${((h=d[10])==null?void 0:h.at(1))??""}:`),n?ws:gs}let l=u(e,-1),g=l(e);return{c(){t=ee("span"),g.c(),r=Bt(),o=ee("a"),s=ee("img"),k(t,"class","makibishi-content svelte-16ydz6r"),k(s,"class","makibishi-profile-picture svelte-16ydz6r"),ke(s.src,i=e[14].picture??nn(e[9].pubkey))||k(s,"src",i),k(s,"alt",c="@"+e[16]),k(s,"title",a="@"+e[16]),k(o,"class","makibishi-link svelte-16ydz6r"),k(o,"href",f=tn+"/"+e[15]),k(o,"target","_blank"),k(o,"rel","noopener noreferrer")},m(d,w){Q(d,t,w),g.m(t,null),Q(d,r,w),Q(d,o,w),Me(o,s)},p(d,w){l===(l=u(d,w))&&g?g.p(d,w):(g.d(1),g=l(d),g&&(g.c(),g.m(t,null))),w&3&&!ke(s.src,i=d[14].picture??nn(d[9].pubkey))&&k(s,"src",i),w&3&&c!==(c="@"+d[16])&&k(s,"alt",c),w&3&&a!==(a="@"+d[16])&&k(s,"title",a),w&1&&f!==(f=tn+"/"+d[15])&&k(o,"href",f)},d(d){d&&(G(t),G(r),G(o)),g.d()}}}function hs(e){let t=e[9].content+"",n;return{c(){n=At(t)},m(r,o){Q(r,n,o)},p(r,o){o&1&&t!==(t=r[9].content+"")&&ln(n,t)},d(r){r&&G(n)}}}function ds(e){let t,n,r,o;return{c(){var s;t=ee("img"),ke(t.src,n=(s=e[10])==null?void 0:s.at(2))||k(t,"src",n),k(t,"alt",r=e[9].content),k(t,"title",o=e[9].content),k(t,"class","svelte-16ydz6r")},m(s,i){Q(s,t,i)},p(s,i){var c;i&1&&!ke(t.src,n=(c=s[10])==null?void 0:c.at(2))&&k(t,"src",n),i&1&&r!==(r=s[9].content)&&k(t,"alt",r),i&1&&o!==(o=s[9].content)&&k(t,"title",o)},d(s){s&&G(t)}}}function gs(e){let t=e[9].content+"",n;return{c(){n=At(t)},m(r,o){Q(r,n,o)},p(r,o){o&1&&t!==(t=r[9].content+"")&&ln(n,t)},d(r){r&&G(n)}}}function ws(e){let t,n,r,o;return{c(){var s;t=ee("img"),ke(t.src,n=(s=e[10])==null?void 0:s.at(2))||k(t,"src",n),k(t,"alt",r=e[9].content),k(t,"title",o=e[9].content),k(t,"class","svelte-16ydz6r")},m(s,i){Q(s,t,i)},p(s,i){var c;i&1&&!ke(t.src,n=(c=s[10])==null?void 0:c.at(2))&&k(t,"src",n),i&1&&r!==(r=s[9].content)&&k(t,"alt",r),i&1&&o!==(o=s[9].content)&&k(t,"title",o)},d(s){s&&G(t)}}}function cn(e){let t,n,r;function o(a,f){return f&3&&(n=null),n==null&&(n=!!a[1].has(a[9].pubkey)),n?sn:us}function s(a,f){return f===sn?ls(a):a}let i=o(e,-1),c=i(s(e,i));return{c(){t=ee("span"),c.c(),r=Bt(),k(t,"class","makibishi-unit svelte-16ydz6r")},m(a,f){Q(a,t,f),c.m(t,null),Me(t,r)},p(a,f){i===(i=o(a,f))&&c?c.p(s(a,i),f):(c.d(1),c=i(s(a,i)),c&&(c.c(),c.m(t,r)))},d(a){a&&G(t),c.d()}}}function ps(e){let t,n,r,o,s,i=Mt(e[0]),c=[];for(let a=0;a<i.length;a+=1)c[a]=cn(on(e,i,a));return{c(){t=ee("span"),n=ee("button"),n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="svelte-16ydz6r"><path fill-rule="evenodd" d="M3.58169903,14.7981322 L4.42551943,9.87828177 L0.851038858,6.39402435 L5.79084952,5.67622784 L8,1.20000005 L10.2091505,5.67622784 L15.1489611,6.39402435 L11.5744806,9.87828177 L12.418301,14.7981322 L8,12.4752939 L3.58169903,14.7981322 Z M8,10.2157425 L9.76203892,11.1421011 L9.42551943,9.18004197 L10.8510389,7.79050395 L8.88101946,7.50424338 L8,5.71910297 L7.11898054,7.50424338 L5.14896114,7.79050395 L6.57448057,9.18004197 L6.23796108,11.1421011 L8,10.2157425 Z"></path></svg>',r=Bt();for(let a=0;a<c.length;a+=1)c[a].c();k(n,"class","makibishi-button svelte-16ydz6r"),k(n,"title","add star"),k(t,"class","makibishi-container svelte-16ydz6r")},m(a,f){Q(a,t,f),Me(t,n),Me(t,r);for(let u=0;u<c.length;u+=1)c[u]&&c[u].m(t,null);o||(s=Fn(n,"click",e[2]),o=!0)},p(a,[f]){if(f&3){i=Mt(a[0]);let u;for(u=0;u<i.length;u+=1){const l=on(a,i,u);c[u]?c[u].p(l,f):(c[u]=cn(l),c[u].c(),c[u].m(t,null))}for(;u<c.length;u+=1)c[u].d(1);c.length=i.length}},i:Re,o:Re,d(a){a&&G(t),Gn(c,a),o=!1,s()}}}function ys(e,t,n){let r,o=[],s=new Map,i,c,a,f;const u=async g=>{if(!URL.canParse(g))return;await rn(r,i,[{kinds:[Kn],"#r":[g]}],w=>{o.some(h=>h.id===w.id)||n(0,o=qo(o,w))});const d=Array.from(new Set(o.map(w=>w.pubkey)));await rn(r,cs,[{kinds:[0],authors:d}],w=>{const h=s.get(w.pubkey);if(h===void 0||h.created_at<w.created_at){try{const p=JSON.parse(w.content)}catch(p){console.warn(p);return}s.set(w.pubkey,w),n(1,s)}})},l=async()=>{await fs(r,i,c,a,!f),await u(c)};return Qn(async()=>{const g=document.getElementById("makibishi");if(g===null){console.warn("makibishi is not found");return}const d=g.dataset.relays,w=g.dataset.url,h=g.dataset.content,p=g.dataset.allowAnonymousReaction;d===void 0?i=is:i=Array.from(new Set(d.split(",").filter(b=>URL.canParse(b)).map(b=>Po(b)))),w===void 0?c=window.location.href:c=URL.canParse(w)?w:window.location.href,a=h??as,p===void 0?f=!1:f=/^true$/i.test(p),console.log("MAKIBISHI Settings:",{relays:i,targetUrl:c,reactionContent:a,allowAnonymousReaction:f}),r=new Co,await u(c)}),[o,s,l]}class bs extends fr{constructor(t){super(),ar(this,t,ys,ps,Zn,{})}}new bs({target:document.getElementById("makibishi")});
